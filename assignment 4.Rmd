---
title: "Assignment 4"
author: "Marco Palombo"
date: "5/18/2022"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include = FALSE, message = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(thematic)
library(scales)
library(equatiomatic)
```

```{r import data}
#import damages data set
damages <- read_csv(here("damages.csv")) %>% 
  #rename column damages because having it names the same thing as the dataset is super stupid
  mutate(harm = damages) %>% 
  select(-damages)

#import warming data set
warming <- read_csv(here("warming.csv"))

```

## Question 1
```{r question 1}
# first add a column to the dataset of damages squared because it seems lm wants that to do a quadratic fit
damages_fit <- damages %>% 
  mutate(warming2 = warming^2)

# perform fit
quad_fit <- lm(harm ~ warming + warming2 + 0, data = damages_fit)
summary(quad_fit)

quad_func <- function(warming){
  harm <- quad_fit$coefficients[1]*warming + quad_fit$coefficients[2]*warming^2
  return(harm)
}

# populate column of harm from fit function
damages_fit$harm_fit = quad_func(damages_fit$warming)

ggplot(data = damages_fit, aes(x = warming, y = harm))+
  geom_point(aes(x = warming, y = harm))+
  geom_smooth(method = "lm", formula = y ~ x + I(x^2))+
  labs(x = "Warming (Degrees Celcius)", y = "Damages (figure out units)")
  
  
```

**Figure 1: Damages vs Warming. Points are from given dataset. Blue line is quadratic fit with zero intercept.**

## Question 2

```{r}
#populate columns of warming with damages for pulse, no pulse, difference between pulse and no pulse, difference in damage per ton co2
#pulse
warming$pulse_damage <- quad_func(warming$warming_pulse)
#nopulse
warming$nopulse_damage <- quad_func(warming$warming_baseline)
# difference
warming$dif <- warming$pulse_damage - warming$nopulse_damage

# unclear how to interpret the per ton CO2 comment for final column. Does this mean divide the whole column by 35? Or is there some sort of temporal component. Given it is referred to as a one time release today I will assume the 35 is in the air at the beginning of the dataset and will therefore simply divide the difference by 35
warming$dif_per_ton <- warming$dif/35e9

# now generate the plots
# no pulse
ggplot(data = warming)+
  geom_point(aes(x = year, y = nopulse_damage))+
  labs(title = "no pulse", x = "Calendar year", y = "Damages (unknown units)", 
       caption = "Figure 2: damages from no pusle with respect to year")

# pulse
ggplot(data = warming)+
  geom_point(aes(x = year, y = pulse_damage))+
  labs(title = "pulse", x = "Calendar year", y = "Damages (unknown units)", 
       caption = "Figure 3: damages from pulse with respect to year")

# difference
ggplot(data = warming)+
  geom_point(aes(x = year, y = dif))+
  labs(title = "difference", x = "Calendar year", y = "Damages (unknown units)", 
       caption = "Figure 4: difference in damages with respect to year")

# difference per ton
ggplot(data = warming)+
  geom_point(aes(x = year, y = dif_per_ton))+
  labs(title = "difference per ton", x = "Calendar year", y = "Damages (unknown units)", 
       caption = "Figure 5: difference in damages per tone CO2 with respect to year")
```

## Question 3

```{r}
# first calculate the net damages up to 2100 due to single tone of CO2. this will be accomplished by summing the column defined as the difference per ton
net_harm_per_ton <- sum(warming$dif_per_ton)

#create function of net present value 
#inputs
#rate: discount rate (%)
#damage: total damages at time t
#time: time at which damages have accrued
#present_time: time at which net present value is calculated

discount_damages <- function(rate, damage, time, present_time){
  NPV <- damage/ (1 + (rate/100))^(time-present_time)
  return(NPV)
}

# initialize dataframe for discounting
discount <- data_frame(rates = seq(0,10, 0.1), SCC = seq(0,10, 0.1))

#use for loop to calculate discounted damages up to 2100 for discount rates from 0 to 10
for(x in 0:length(discount$rates)){
  #apply function from above and sum all elements in column to find net discounted cost
  discount$SCC[x] <- sum(discount_damages(discount$rates[x],warming$dif_per_ton, warming$year, 2021))
}

ggplot(data = discount)+
  geom_point(aes(x = rates, y = SCC))

```

**Figure 6: net present value of future damages between 2021 and 2100 at time 2021 discounted with respect to various discount rates**


## Question 4

```{r}
#determine r from the equation given
#define values
rho <- .001 
eta <- 2 
g <- .01

#plug into the Gordon Ramsay Rule
r_gordon_ramsey <- rho + eta*g

# now plug into the previous equation and sum to find SCC
discount_gordon_ramsey <- sum(discount_damages(r_gordon_ramsey,warming$dif_per_ton, warming$year, 2021))

#plot this dumb thing
ggplot(data = discount)+
  geom_point(aes(x = rates, y = SCC))+
  geom_point(x = r_gordon_ramsey, y = discount_gordon_ramsey, color = "blue", size = 4)
```

**Figure 7: Net present value of future damages between 2021 and 2100 at time 2021 discounted with respect to various discount rates. Blue point shows discount rate and SCC associatd with recommendation made by The National Academies of Sciences, Engineering, and Medicine**